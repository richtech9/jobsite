<?php/*Template Name: Linguists Content Template*//** current-php-code 2020-Oct-13* input-sanitized : lang* current-wp-template:  freelancer content control panel* current-wp-top-template*/$lang = FLInput::get('lang', 'en');check_login_redirection_home($lang);if (current_user_can('administrator')) {    wp_redirect(admin_url());    exit();}if (! (is_user_logged_in() && (xt_user_role() == "translator"))) {    wp_redirect('/dashboard/');    exit();}$auto_job_rejected_for_linguist_hours_minutes = floatval(get_option('auto_job_rejected_for_linguist_hours')) * 60;get_header();$paged 		= ( get_query_var('paged') ) ? get_query_var('paged') : 1;$paged = (int)$paged;if ($paged < 1) { $paged = 1;}$post_id_per_page = 20;$post_id_offset = ($paged -1) * $post_id_per_page;?><style>    @media (max-width: 767px) {        #datatable thead {            display: none;        }        #datatable tbody td:nth-child(2):before {            content: "Title";        }        #datatable tbody td:nth-child(3):before {            content: "Status";        }        #datatable tbody td:nth-child(4):before {            content: "Sale Type";        }        #datatable tbody td:nth-child(5):before {            content: "Price/Highest Bid";        }        #datatable tbody td:nth-child(6):before {            content: "Edit";        }        #datatable tbody td:nth-child(7):before {            content: "Delete";        }        #datatable tbody td::before {            background-color: #e5eef3;            border-right: 1px solid #c8d5dc;            bottom: 0px;            color: #000000;            content: "";            /* replaced fontsize 12 */            left: 0px;            padding: 13px 7px;            position: absolute;            top: 0px;            width: 130px;        }        #datatable tbody td:first-child {            border-top: 1px solid #c8d5dc;        }        #datatable tbody td {            min-height: 50px;        }        #datatable tbody td {            display: block;            float: left;            padding-left: 140px;            position: relative;            width: 100%;            border-bottom: 1px solid #c8d5dc;        }        #datatable tbody .viewAllOfferTable thead {            display: none;        }        #datatable tbody .viewAllOfferTable td:first-child:before {            content: "User";        }        #datatable tbody .viewAllOfferTable td:nth-child(2):before {            content: "Amount";        }        #datatable tbody .viewAllOfferTable td:nth-child(3):before {            content: "Status";        }        #datatable tbody .viewAllOfferTable td:nth-child(4):before {            content: "Bid Time";        }        #datatable tbody .viewAllOfferTable td:nth-child(5):before {            content: "Action";        }    }</style><section class="middle-content rr dashboard-content">    <div class="container">        <div class="dashboard-content-head">            <a class="addcont red-btn-no-hover red-background-white-text freelinguist-new-content-button large-text"                href="<?php echo freeling_links('linguist_add_content_url'); ?>"            >                <div>                    <i class="fa fa-plus red-background-white-text"></i>                    <span class="">New Sale</span>                </div>            </a>            <a class="deletcont delete_linguist_content_multiple" href="javascript:">                <i class="fa fa-trash"></i>Delete Selected            </a>        </div>        <form class="table-responsive " style="width:100%" id="checkboxlist">            <table id="datatable" width="100%" class="freelinguist-open-up-body">                <thead>                    <tr style="background:#a2a2a2;">                        <th class="large-text" style="padding:0 5px 0 15px;"><!--input type="checkbox"--></th>                        <th class="large-text" width="40%">Title</th>                        <th class="large-text">Status</th>                        <th class="large-text">Sale Type</th>                        <th class="large-text">Price/Highest Bid</th>                        <!--th style="text-align:center">View</th-->                        <th class="large-text" style="text-align:center">View</th>                        <th class="large-text" style="text-align:center">Delete</th>                    </tr>                </thead>                <tbody>                <?php                global $wpdb;                $linguId = get_current_user_id();                $sql_total_count = "SELECT count(*) as da_count from wp_linguist_content                         WHERE parent_content_id IS NULL AND user_id = $linguId";                $da_total_job_count = $wpdb->get_var($sql_total_count);                $total_pages = (int)ceil($da_total_job_count/$post_id_per_page);                $query_part = $_SERVER['QUERY_STRING'];                $url_template = get_site_url() . '/linguist-content/page/%page%/?'.$query_part;                $sql =                    "SELECT line.*,sold_summary.da_count as number_copies,                      IF(line.parent_content_id,'child','parent') as line_type,                   UNIX_TIMESTAMP( rejected_at ) as rejected_at_ts                    FROM wp_linguist_content line                    LEFT JOIN (                        SELECT count(*) as da_count, parent_content_id                        FROM wp_linguist_content                        WHERE parent_content_id IS NOT NULL                          AND purchased_by IS NOT NULL                        GROUP BY parent_content_id                        ) as sold_summary ON sold_summary.parent_content_id  = line.id                     INNER JOIN (                        SELECT id from wp_linguist_content                         WHERE parent_content_id IS NULL AND user_id = $linguId                        ORDER BY id desc                        LIMIT $post_id_per_page OFFSET $post_id_offset                     )   as driver ON (driver.id = line.id OR driver.id = line.parent_content_id)                    where user_id = $linguId                                        ORDER BY                      CASE line_type                      WHEN 'child' THEN line.parent_content_id                      WHEN 'parent' THEN line.id                      ELSE 1 END                                          DESC,                                                                  CASE line_type                      WHEN 'child' THEN line.id                      WHEN 'parent' THEN 99999999                      ELSE 1 END                                          DESC                                           ;                                        ";                $linguist_contents_list = $wpdb->get_results($sql, ARRAY_A);                if (!empty($linguist_contents_list)) {                    $i = 0;                    foreach ($linguist_contents_list as $key => $value) {                        $data_link = freeling_links('linguist_add_content_url').'&mode=edit&content_id='.                            FreelinguistContentHelper::encode_id($value['id']);                        $new_date = '';                        if ($i % 2 == 0) {                            ?>                            <tr class="<?= ($value['parent_content_id'] ? 'fl-copied-content fl-show-copied-content' : 'fl-original-content') ?>"                                data-pid="<?= $value["parent_content_id"]?>"                            >                            <?php                        } else {                            ?>                            <tr style="background:#f4f4f4"                                class="<?= ($value['parent_content_id'] ? 'fl-copied-content fl-show-copied-content' : 'fl-original-content') ?>"                                data-pid="<?= $value["parent_content_id"]?>"                            >                            <?php                        }                ?>                        <td class="enhanced-text" style="">                            <div class="fl-align-content-container">                                <?php if ($value['publish_type'] != "Purchased"): ?>                                    <input title="Delete Content" name="delete_content_ids[]"                                           value="<?= $value['id'] ?>" type="checkbox">                                <?php endif; ?>                                <?php if ($value['number_copies']) { ?>                                    <span class="fl-content-action-expand-copies fl-show-copied-content"                                          title="Expand Sold Content"                                          data-cid="<?= $value["id"]?>"                                    >                                       <i class="fa fa-plus-circle   fl-expand-icon fl-click-to-expand"></i>                                        <i class="fa fa-minus-circle fl-expand-icon fl-click-to-squish"></i>                                    </span>                                <?php } ?>                            </div>                        </td>                        <td style="cursor: pointer;"                            class="viewContent enhanced-text "                            data-link="<?= $data_link ?>">                            <?php if ($value['parent_content_id']) { ?>                                <span class="fl-content-title fl-copied-content">                                    <?= stripcslashes($value['content_title']) ?>                                </span>                            <?php } else { ?>                                <span class="fl-content-title fl-original-content">                                    <?= stripcslashes($value['content_title']) ?>                                </span>                            <?php }?>                        </td>                        <td style="cursor: pointer;"                            data-cid="<?= $value['id'] ?>"                            class=" will-tag enhanced-text <?=                                ((!$value['parent_content_id'] && intval($value['number_copies']) ) ?                                    'fl-click-to-expand-copies' :                                    'viewContent') ?>"                            <?php if ( !intval($value['number_copies'])) { ?>                                data-link="<?=$data_link ?>"                            <?php } ?>                            >                            <?php                            $con_status = $value['publish_type'];                            $new_date = (intval($value['rejected_at_ts']) + (60 * $auto_job_rejected_for_linguist_hours_minutes))*1000;                            if ($value['publish_type'] == 'Purchased') {                                $con_status = 'Delivery';                            }                            if ($value['status'] == 'request_rejection') {                                $con_status = 'Dispute(<span                                     class="demo_time"                                     data-content_id="' . $value['id'] . '"                                     id="content_time_' . $value['id'] . '"                                     data-new_date="' . $new_date . '"></span>)';                            }                            elseif ($value['status'] == 'completed') {                                $con_status = 'Completed';                            }                            elseif ($value['status'] == 'rejected') {                                $con_status = 'Rejected';                            }                            elseif ($value['status'] == 'hire_mediator') {                                $con_status = 'Mediation';                            } elseif ($value['status'] == 'cancelled') {                                $con_status = 'Cancelled';                            }                            elseif ( intval($value['number_copies'])) {                                $copy_word = 'copies';                                if (intval($value['number_copies']) === 1) {                                    $copy_word = 'copy';                                }                                $con_status = '<span>'.'SOLD ('.$value['number_copies'] . ' '. $copy_word .')'.'</span>' ;                            }                            echo $con_status;                            ?>                            <?php                            $red_dot_type = FLRedDot::TYPE_CONTENT;                            //FLRedDot::turn_on_debugging(FreelinguistDebugging::LOG_DEBUG);                            ?>                            <?= FLRedDot::generate_dot_html_for_user(                                [$red_dot_type],$value['id']                            )                            ?>                        </td>                        <td class="viewContent enhanced-text"                            data-link="<?= $data_link ?>">                            <?php                                $da_sale_type = $value['content_sale_type'];                                if ($da_sale_type === 'Fixed') {                                    $da_sale_type = 'Price';                                }                                echo $da_sale_type;                            ?>                        </td>                        <?php if ($value['content_sale_type'] == "Offer") {                            if ($value['offersBy']) {                                $price_array = array();                                $allOffers = unserialize($value['offersBy']);                                foreach ($allOffers as $inOffers) {                                    array_push($price_array, $inOffers['amount']);                                }                                if (count($price_array) > 0) {                                    echo '<td style="cursor: pointer;" class="viewContent--" data-link="' .                                        freeling_links('linguist_add_content_url') . '&mode=edit&content_id=' . FreelinguistContentHelper::encode_id($value['id']) .                                        '">$' . max($price_array) . ' USD ' . viewOffersHtml($value) . '</td>';                                } else {                                    echo '<td style="cursor: pointer;" class="viewContent--" data-link="' .                                        freeling_links('linguist_add_content_url') . '&mode=edit&content_id=' . FreelinguistContentHelper::encode_id($value['id']) .                                        '">$' . amount_format($value['content_amount']) . ' USD ' . viewOffersHtml($value) . '</td>';                                }                            } else {                                echo '<td style="cursor: pointer;" class="viewContent" data-link="' .                                    freeling_links('linguist_add_content_url') . '&mode=edit&content_id=' . FreelinguistContentHelper::encode_id($value['id']) . '">$' .                                    amount_format($value['content_amount']) . ' USD</td>';                            }                        } else {                            echo '<td style="cursor: pointer;" class="viewContent" data-link="' .                                freeling_links('linguist_add_content_url') . '&mode=edit&content_id=' . FreelinguistContentHelper::encode_id($value['id']) .                                '">$' . amount_format($value['content_amount']) . ' USD</td>';                        } ?>                        <td class="enhanced-text" style="text-align:center">                            <a href="<?php echo freeling_links('content_detail_url') . '&mode=view&content_id=' . FreelinguistContentHelper::encode_id($value['id']); ?>">                                <i class="fa fa-eye"></i>                            </a>                        </td>                        <td class="enhanced-text" style="text-align:center">                            <?php if ($value['publish_type'] != "Purchased"): ?>                                <a class="delete_linguist_content"                                   id="<?= $value['id'] ?>"                                   href="#">                                        <i class="fa fa-trash"></i>                                </a>                            <?php endif; ?>                        </td>                    </tr>                    <?php } //end loop of content                } // end if not empty                else {  /* else not any content*/?>                    <tr style="background:#f4f4f4">                        <td style="text-align:center" colspan="8">No record Exist</td>                    </tr>                <?php } //end showing content ?>                </tbody>            </table>        </form>    </div>    <?php    freelinguist_print_pagination_bar($paged,$total_pages,$url_template,'bottom');    ?></section><!--suppress HtmlUnknownTarget --><?php get_footer('homepagenew'); ?><script>    jQuery(function () {        jQuery('.viewContent').click(function () {            window.location.href = jQuery(this).data('link');        });        jQuery('.demo_time').each(function () {            var content_id = jQuery(this).data('content_id');            var countDownDate = new Date(parseInt(jQuery(this).data('new_date'))).getTime();            // Update the count down every 1 second            var x = setInterval(function () {                var now = new Date().getTime();                // Find the distance between now and the count down date                var distance = countDownDate - now;                // Time calculations for days, hours, minutes and seconds                var days = Math.floor(distance / (1000 * 60 * 60 * 24));                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));                var seconds = Math.floor((distance % (1000 * 60)) / 1000);                // Display the result in the element with id="demo"                document.getElementById("content_time_" + content_id + "").innerHTML = days + "d " + hours + "h "                    + minutes + "m " + seconds + "s  left";                // If the count down is finished, write some text                if (distance < 0) {                    clearInterval(x);                    document.getElementById("content_time_" + content_id + "").innerHTML = "EXPIRED";                }            }, 5000);        });    });</script><script>    jQuery(function($) {        $(".a-timestamp-full-date-time").each(function () {            var qthis = $(this);            var ts = $(this).data('ts');            if (ts === 0 || ts === '0' || ts === undefined || ts === '') {                qthis.text('');            } else {                var ts_number = parseInt(ts.toString());                var m = moment(ts_number * 1000);                qthis.text(m.format('MMM D YYYY H:mm'));            }        });    });</script>