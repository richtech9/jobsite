<link href="<?php echo get_template_directory_uri() . '/css/current-code/content-customer.css?version=0.1.1'; ?>" rel="stylesheet"><?php/** current-php-code 2020-Oct-13* input-sanitized : content_id,lang,mode,section* current-wp-template:  freelancer content view*/global $wpdb;$content_id_encoded = FLInput::get('content_id', 0);$lang = FLInput::get('lang', 'en');$mode = FLInput::get('mode');$section = FLInput::get('section');$content_detail = array();$content_chapter_detail = array();$content_id = 0;if ($mode === 'view') {    $content_id =  FreelinguistContentHelper::decode_id($content_id_encoded);    $user_id = get_current_user_id();    $content_detail = $wpdb->get_row("select * from wp_linguist_content where id=$content_id and user_id = $user_id", ARRAY_A);    if (!empty($content_detail)) {        $content_id = $content_detail['id'];        $content_chapter_detail = $wpdb->get_results(                "SELECT *                         FROM wp_linguist_content_chapter                         WHERE user_id IS NOT NULL AND linguist_content_id=$content_id                          ORDER BY page_number ASC                        ", ARRAY_A);        $user_Detail = get_userdata($content_detail['user_id']);    }    if (empty($content_detail)) {        wp_redirect('/dashboard/');        exit();    }    ?>    <section class="pagetitle">        <div class="container">            <div class="bredcum"></div>        </div>    </section>    <div class="content-area">        <div class="container freelinguist-id-area">            <div class="row">                <div class="col-lg-6">                    <div class="left_content_img">                        <?php                        //code-notes [image-sizing]  content get large sized image for content cover                        $cover_image_url = FreelinguistSizeImages::get_url_from_relative_to_upload_directory($content_detail['content_cover_image'],                            FreelinguistSizeImages::LARGE,true);                        ?>                        <img src="<?=$cover_image_url ?>">                    </div>                </div>                <div class="col-lg-6">                    <div class="right_content_text">                        <strong><?= stripslashes_deep($content_detail['content_title']) ?>                            <?php if ($content_detail['content_sale_type'] == "Offer") {                                if ($content_detail['offersBy']) {                                    $price_array = array();                                    $allOffers = unserialize($content_detail['offersBy']);                                    foreach ($allOffers as $inOffers) {                                        array_push($price_array, $inOffers['amount']);                                    }                                    if (count($price_array) > 0) {                                        echo '<strong>$' . max($price_array) . '</strong>';                                    } else {                                        echo '<strong>$' . amount_format($content_detail['content_amount']) . '</strong>';                                    }                                } else {                                    echo '<strong>$' . amount_format($content_detail['content_amount']) . '</strong>';                                }                            } else { ?>                                <strong>$<?php echo amount_format($content_detail['content_amount']) ?></strong>                            <?php } ?>                            <hr>                            <p>Author: <?php echo $user_Detail->display_name; ?></p>                            <p>Type: <?php echo $content_detail['publish_type'] ?></p>                            <p>Sale Type: <?php echo $content_detail['content_sale_type'] ?></p>                            <p>Number for Sale: <?php echo $content_detail['max_to_be_sold'] ?></p>                            <?php if (get_current_user_id() == $content_detail['user_id']) {                                $allOffers = unserialize($content_detail['offersBy']);                                ?>                                <div class="allOffers">                                    <?php if (empty($content_detail['offersBy'])) {                                        echo '<span>No offers till now.</span>';                                        $allOffers = [];                                    } ?>                                    <div class="modal fade" id="viewAllOfferModel" tabindex="-1" role="dialog"                                         aria-labelledby="myModalLabel" aria-hidden="true">                                        <div class="modal-dialog awardpop-box">                                            <div class="modal-content">                                                <div class="modal-header">                                                    <button type="button" class="close huge-text" data-dismiss="modal">                                                        &times;                                                    </button>                                                    <h4 class="modal-title">List of Offers by Customers </h4>                                                </div>                                                <div class="modal-body offersTab">                                                    <?php                                                    //code-bookmark this should also show the list of offers by customers, to the freelancer to accept or reject                                                    foreach ($allOffers as $inOffers) {                                                        $userDetail = get_userdata($inOffers['cust_id']);                                                        echo '<div class="row"><div class="col-md-12">';                                                        echo '<p>Offer by User: ' . $userDetail->display_name . ' ( ' . $userDetail->user_email .                                                            ' ) of amount : ' . $inOffers['amount'] . '</p>';                                                        echo '<a uid="' . $inOffers['cust_id'] . '" cid="' . $content_id .                                                            '" style="margin-bottom: 20px; width: 150px;" '.                                                            'class="btn blue-btn next-btn postproject accpetrejOffer regular-text" '.                                                            'todo="accept" href="#"><i class="fa fa-shopping-cart  large-text"></i> Accept Offer</a>';                                                        echo '<a uid="' . $inOffers['cust_id'] . '" cid="' . $content_id .                                                            '" style="margin-bottom: 20px; width: 150px;" '.                                                            'class="btn blue-btn next-btn postproject accpetrejOffer regular-text" '.                                                            'todo="reject" href="#"><i class="fa fa-shopping-cart  large-text"></i> Reject</a>';                                                        echo '<span class="respoReply' . $inOffers['cust_id'] . '"></span>';                                                        echo '<br>';                                                        echo '</div></div>';                                                    }                                                    ?>                                                </div>                                            </div>                                        </div>                                    </div>                                </div>                            <?php } ?>                    </div>                    <hr>                    <p>                        <?php                        echo stripslashes_deep(substr($content_detail['content_summary'], 0, 500));                        if (strlen(stripslashes_deep($content_detail['content_summary'])) > 500) {                            echo '..';                        }                        ?>                    </p>                    <a href="<?php echo site_url() . '/content/?lang=en&mode=read&content_id=' . $content_id_encoded; ?>"                       class="box-prement2"><i class="fa fa-user" aria-hidden="true"></i> Read</a>                </div>            </div>            <div class="freelinguist-id-display" >                        <span class="small-text">                            <?= $content_id?>                        </span>            </div>        </div>    </div>    <!-- code-notes removed content discussion from content view and put it in content edit-->    <!-- code-notes removed message history from content view-->    <!-- code-notes removed posted feedback and content history from view -->    <section>        <div class="main_content">            <div class="container">                <div class="row">                    <div class="col-lg-12 col-md-12 col-sm-12">                        <div class="left_site_bar" style="margin-top: 1em">                            <?php                                set_query_var( 'content_id', $content_id );                                get_template_part('includes/user/contentdetail/contentdetail', 'public-discussion');                            ?>                        </div> <!-- /.left-site-bar -->                    </div> <!-- /.col -->                </div> <!-- /.row -->            </div> <!-- /.container -->        </div> <!-- /.main-content -->    </section>    <div style="width: 100%; display: block;height: 10em;"></div>    <?php}if ($mode === 'read') {    $content_id = FreelinguistContentHelper::decode_id($content_id_encoded);    $content_chapter_detail = $wpdb->get_results(            "SELECT *                     FROM wp_linguist_content_chapter                     WHERE user_id IS NOT NULL AND linguist_content_id=$content_id                     ORDER BY page_number ASC                    ", ARRAY_A);    $rows = sizeof($content_chapter_detail);    $offset = 0;    $page = 1;    $limit = 1;    if ($section) {        $page = $section;        $offset = ($page - 1) * $limit;    }    $totalpages = ceil($rows / $limit);    $chapter_detail = $wpdb->get_row(            "SELECT *                     FROM wp_linguist_content_chapter                     WHERE user_id IS NOT NULL AND linguist_content_id = $content_id                      ORDER BY page_number ASC                     LIMIT " . $offset . "," . $limit            , ARRAY_A);    ?>    <section>        <div class="header-area">            <div class="middle-content rr container">                <div class="row">                    <div class="col-lg-7 col-md-7 col-sm-12">                        <div class="header-title"><span                                    class="bold-and-blocking large-text"><?= $chapter_detail['title'] ?></span>                        </div>                    </div>                    <div class="col-lg-9 col-md-12 col-sm-12">                        <div class="fl-content-chapter-html-container">                            <?= $chapter_detail['content_html']; ?>                        </div>                    </div>                </div>                <div class="page-area">                    <div class="row">                        <div class="col-lg-4 col-md-4 col-sm-12">                            <a href="<?php echo site_url() . '/content/?lang=' . $lang . '&mode=view&content_id=' . $content_id_encoded; ?>"                               class="box-page">Home</a>                        </div>                        <div class="col-lg-8 col-md-8 col-sm-12">                            <?php                            if ($totalpages > 1) { ?>                                <div class="box-number">										<span class="enhanced-text" style="float:left;">Page <?php echo $page; ?>                                            of <?php echo $totalpages; ?></span>                                    <?php                                    for ($i = 1; $i <= $totalpages; $i++) {                                        $href = site_url() . '/content/?lang=en&mode=read&content_id=' . FreelinguistContentHelper::encode_id($content_id) . '&section=' . $i;                                        ?>                                        <a class="enhanced-text" href="<?php echo $href; ?>"><?php echo $i; ?></a>                                        <?php                                    }                                    $href = site_url() . '/content/?lang=en&mode=read&content_id=' . FreelinguistContentHelper::encode_id($content_id) .                                        '&section=' . $totalpages;                                    ?>                                    <a class="enhanced-text" href="<?php echo $href; ?>">Last</a>                                </div> <!-- /.cbox-number -->                            <?php } ?>                        </div> <!-- /.col -->                    </div> <!-- /.row -->                </div> <!-- /.page-area -->            </div> <!-- /.middle-content -->        </div> <!-- /.header-area -->    </section><?php }