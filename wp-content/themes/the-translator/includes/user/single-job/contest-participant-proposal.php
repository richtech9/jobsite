<?php/** current-php-code 2020-Oct-25* input-sanitized : lang,linguist, proposalId* current-wp-template:  customer viewing of proposal*/global $wpdb;global $post;$SiteLang = FLInput::get('lang', 'en');$currLingu = (int)FLInput::get('linguist');$proposalId = (int)FLInput::get('proposalId');$job_freeze = false;$post_id = get_the_ID();$current_user = wp_get_current_user();$current_user_id = $current_user->ID;$author_id = $post->post_author;$prizesAwarded = get_post_meta($post_id, 'contest_awardedProposalPrizes', true);$proposalPresent = explode(',', $prizesAwarded);$addParticipants = get_post_meta($post_id, 'all_contest_paricipants', true);$curParti = explode(',', $addParticipants);$uploads = wp_upload_dir();$job_type = get_post_meta($post_id, 'fl_job_type', true);?><style>    .slide-inn figure {        height: auto !important;    }    .slider .eye img, .eye img {        display: inline-block !important;        height: auto !important;        width: auto !important;        vertical-align: middle;        background: transparent !important;        margin: 0 auto;    }    .slide-inn .eye {        left: 0;        position: absolute;        text-align: center;        top: 40%;        width: 100%;        z-index: 10;        display: none;    }</style><div class="customer-participants view job_dtls">    <div class="title-top">        <div class="container"><i class="icon icon-box"></i>            <p class="large-text">                <?php echo get_post_meta($post_id, 'project_title', true); ?>            </p>        </div>    </div>    <section class="middle-content">        <div class="container participant-sec">            <div class="row submissions_btnss">                <?php                $auth_or = $post->post_author;                $proposal_sql =                    "SELECT * FROM wp_files WHERE `post_id` = $post_id AND proposal_id = $proposalId AND by_user != $auth_or";                $participants = $wpdb->get_results($proposal_sql);                $allproposal = $wpdb->get_results("SELECT * FROM wp_proposals  WHERE post_id = $post_id  AND by_user != $auth_or order by id desc");                ?>                <div class="col-md-4 no-padding-no-margin">                    <a  class="hirebttn2"                        href="<?php echo get_site_url(); ?>/job/<?php echo get_the_title($post_id); ?>/?lang=<?php echo $SiteLang; ?>&action=participants-proposals"                    >                        All Proposals                    </a>                    <div class="labels enhanced-text"><?php                        if (count($participants) != 0) {                            echo count($participants) . ' submissions';                        } else {                            echo 'no submissions.';                        }                        ?></div>                </div>                <div class="col-md-4 no-padding-no-margin">                    <a class="hirebttn2 fr"                       href="<?php echo get_site_url(); ?>/job/<?php echo get_the_title($post_id); ?>/?lang=<?php echo $SiteLang; ?>"                    >                        Job Details                    </a>                </div>                <div class="col-md-4 no-padding-no-margin">                    <?php                    if ($current_user_id == $author_id && !$job_freeze) {                        if (!in_array($proposalId, $proposalPresent)) {                            echo '<a href="#" class="blk-Btn-nw awardProposalPrize red-text a-button fr regular-text" linguist="' .                                $currLingu . '" proposal_id = "' . $proposalId . '" data-toggle="modal" data-target="#awardPops"> Award This Proposal </a>';                        } else {                            echo '<a href="#" class="blk-Btn-nw green-text a-button fr regular-text"> Prize Awarded </a>';                        }                    }                    ?>                </div>            </div>        </div> <!--- /.container -->        <div class="content-sec">            <div class="container">                <div class="col-md-9 slide-sec">                    <?php                    $fileUrl = array();                    $up_loads = $wpdb->get_results("SELECT * FROM wp_files WHERE `post_id` = $post_id AND proposal_id = $proposalId AND by_user=$currLingu");                    foreach ($up_loads as $uploaded) {                        $fileUrl[] = $uploads['baseurl'] . '/' . $uploaded->file_path;                    }                    $countFiles = count($fileUrl);                    if (count($up_loads) > 0) {                        ?>                        <div id="myCarousel" class="carousel slide" data-ride="carousel">                            <div class="carousel-inner">                                <?php                                $sl = 1;                                foreach ($fileUrl as $key => $value) {                                    $extension = pathinfo($value, PATHINFO_EXTENSION);                                    ?>                                    <div class="item <?php echo($sl == 1 ? "active" : ""); ?>">                                        <?php                                        if ($extension == 'pdf') {                                            ?>                                            <embed src="<?= $value ?>" width="100%" height="600" type="application/pdf">                                            <?php                                        } elseif ($extension == 'txt') {                                            ?>                                            <iframe src="<?= $value ?>" width="100%" height="600"></iframe>                                            <?php                                        } elseif ($extension == 'php') {                                            ?>                                            <iframe src="<?= $value ?>" width="100%" height="600"></iframe>                                            <?php                                        } elseif ($extension == 'mp3') {                                            ?>                                            <audio controls>                                            <source src="<?= $value ?>" type="audio/mpeg"></audio>                                            <?php                                        } elseif ($extension == 'doc' || $extension == 'docx') {                                            ?>                                            <object data="<?= $value ?>" type="application/msword"></object>                                            <?php                                        } elseif ($extension == 'mp4' || $extension == 'mov' || $extension == '3gp') {                                            ?>                                            <video width="400" controls>                                                <source src="<?= $value ?>" type="video/mp4">                                                Your browser does not support HTML5 video.                                            </video>                                            <?php                                        } else {                                            ?>                                            <a href="#" id="showImageModel">                                                <img src="<?= $value ?>" alt="Cannot open <?=$extension?>" style="width:100%;">                                            </a>                                            <?php                                        }                                        ?>                                    </div> <!-- /.item -->                                    <?php                                    $sl++;                                }                                ?>                            </div> <!-- /.carousol-inner -->                            <!-- Left and right controls -->                            <?php                            $nextHref = "";                            $prevHref = "";                            $proposalLinks = array();                            foreach ($allproposal as $key => $value) {                                if (intval($value->by_user)) {                                    $href = get_site_url() . '/job/' . get_the_title($post_id) . '/?lang=' . $SiteLang . '&action=proposal&linguist=' .                                        $value->by_user . '&proposalId=' . $value->id;                                } else {                                    $href = '';                                }                                array_push($proposalLinks, $href);                            }                            $currentHref = get_site_url() . '/job/' . get_the_title($post_id) . '/?lang=' . $SiteLang . '&action=proposal&linguist=' .                                $currLingu . '&proposalId=' . $proposalId;                            $key = array_search($currentHref, $proposalLinks);                            if (isset($proposalLinks[$key - 1])) {                                $prevHref = $proposalLinks[$key - 1];                            }                            if (isset($proposalLinks[$key + 1])) {                                $nextHref = $proposalLinks[$key + 1];                            }                            ?>                            <a class="left carousel-control" href="<?php if ($prevHref != "") {                                echo $prevHref;                            } else { ?>#myCarousel<?php } ?>" data-slide="prev">                                <span class="flex-nav-prev"></span>                            </a>                            <a class="right carousel-control" href="<?php if ($nextHref != "") {                                echo $nextHref;                            } else { ?>#myCarousel<?php } ?>" data-slide="next">                                <span class="flex-nav-next"></span>                            </a>                            <?php                            $proposal = $wpdb->get_results("SELECT * FROM wp_proposals WHERE `post_id` = $post_id  AND id = $proposalId");                            if (in_array($proposal[0]->by_user, get_post_meta($post_id, 'job_freeze_user')) &&                                !empty(get_post_meta($post_id, 'job_freeze_user')))                            {                                $job_freeze = true;                            }                            foreach ($proposal as $k => $v):                                $html_description = '';                                if ($v->proposal_description) {                                    $html_description = nl2br($v->proposal_description);                                }                                if (!$job_freeze) {                                    ?>                                    <div class="rating-img">                                        <div class="ratingss" id="proposal-<?php echo $v->id; ?>">                                            <input type="hidden" name="rating" id="rating" value="<?php echo $v->rating; ?>"/>                                            <ul onMouseOut="resetRating(<?php echo $v->id; ?>);">                                                <?php                                                for ($i = 1; $i <= 5; $i++) {                                                    $selected = "";                                                    if (!empty($v->rating) && $i <= $v->rating) {                                                        $selected = "selected";                                                    }                                                    ?>                                                    <li class='<?php echo $selected; ?> large-text'                                                        onmouseover="highlightStar(this,<?php echo $v->id; ?>);"                                                        onmouseout="removeHighlight(<?php echo $v->id; ?>);"                                                        onClick="addRating(this,<?php echo $v->id; ?>);"                                                    >                                                        ★                                                    </li>                                                <?php } ?>                                            </ul>                                        </div> <!-- /.ratings -->                                        <div class="freelinguist-id-display freelinguist-under-proposal-rating" style="">                                            <span class="small-text">                                                <?= $v->id?>                                            </span>                                        </div>                                    </div> <!-- /.rating-img -->                                <?php }                            endforeach; ?>                        </div> <!-- /.carousol -->                        <div class="row ">                            <!-- code-notes put new description here-->                            <div class="fl-proposal-description">                                <?= $html_description ?>                            </div>                        </div>                        <!--  task-future-work change this report link to a report ajax used by the others , maybe hz_submit_report -->                        <a href="mailto:<?php echo get_option('admin_email'); ?>" class="red-btn grey regular-text">                            <img src="<?php echo get_site_url(); ?>/wp-content/themes/the-translator/images/post-icon.png"                                 class="post-icon">                            Report                        </a>                    <?php } else {                        echo '<span>The freelancer has not uploaded any files.</span>';                    } ?>                </div> <!-- /.col -->                <div class="col-md-3 right-notify ">                    <?php                    $transDay = get_post_meta($post_id, 'job_standard_delivery_date', true);                    $today = date('Y-m-d');                    $time1 = strtotime($transDay);                    $time2 = strtotime($today);                    ?>                    <?php if (!$job_freeze): ?>                        <div id="awardPops" class="modal" role="dialog">                            <div class="modal-dialog">                                <!-- Modal content-->                                <div class="modal-content">                                    <div class="modal-header">                                        <button type="button" class="close huge-text" data-dismiss="modal">                                            &times;                                        </button>                                        <h4 class="modal-title">                                            Award Prize to this proposal                                        </h4>                                    </div>                                    <div class="modal-body hirepopup">                                        <div class="row">                                            <div class="col-md-12">                                                <button linguId="" class="bttns btn blue-btn"                                                         contestId="<?php echo $post_id; ?>" id="yes_proposal_btn"                                                >                                                    Yes                                                </button>                                                <span class="awardResponse"></span>                                            </div>                                        </div>  <!-- /.row -->                                    </div>  <!-- /.modal-body -->                                </div>  <!-- /.modal-content -->                            </div> <!-- /.modal-dialog -->                        </div> <!-- /.modal -->                        <div id="awardPops" class="pop_box enhanced-text">                            <div class="awardpop-box">                                <a href="#" id="awardDash" class="button_cross huge-text">x</a>                                <span class="bold-and-blocking larger-text">Award prize to this proposal. You can still request revisions. </span>                                <a href="#" linguId="" class="bttns"                                   contestId="<?php echo $post_id; ?>" id="yes_proposal_btn"                                >                                    Yes                                </a>                                <a href="#" id="no_btn" class="bttns">No</a>                                <span class="awardResponse"></span>                            </div> <!-- /.awardpop-box -->                        </div> <!-- /.pop_box -->                    <?php endif; ?>                    <div class="hz_discussion_row prize-lists">                        <?php echo hz_fl_discussion_list_both($post_id, $current_user_id, $currLingu); ?>                    </div>                    <div class="message-sec text-box">                        <form id="contest_discussion">                            <textarea title="comment" required name="comment" autocomplete="off" ></textarea>                            <input type="hidden" name="post_id" value="<?php echo $post_id; ?>">                            <input type="hidden" name="comment_to" value="<?php echo $currLingu; ?>">                            <input type="submit" class="red-btn enhanced-text" value="Contact Freelancer">                        </form>                    </div> <!-- /.text-box -->                </div> <!-- /.col -->            </div> <!-- /.container -->        </div><!-- /.content-sec -->        <div class="column-sec slide-content">            <div class="container">                <div class="flexslider carousel">                    <ul class="slides">                        <?php                        $par = 1;                        foreach ($allproposal as $key => $value) {                            if (empty(intval($value->by_user))) { continue;}                            $LingUser = get_user_by('id', $value->by_user);                            $mySubmissions = $wpdb->get_results("SELECT * FROM wp_files WHERE `post_id` = $post_id AND by_user = $value->by_user AND proposal_id=$value->id");                            foreach ($mySubmissions as $uploaded) {                                $fileUrl = $uploads['baseurl'] . '/' . $uploaded->file_path;                                break;                            }                            $extension = pathinfo($fileUrl, PATHINFO_EXTENSION);                            $ling_link = freeling_links('user_account') . '&profile_type=translator&user=' . $LingUser->user_login . '&b_url=' . $post_id;                            ?>                            <li class="columns" data-proposal_id="<?= $value->id ?>" data-linguId="<?= $value->by_user ?>">                                <div class="box">                            <div class="num-row large-text">                                        #<?=$par?> by                                        <a href="<?= $ling_link ?>" target="_blank">                                            <?= $LingUser->display_name ?>                                        </a>                                    </div>                                    <a href="<?= get_site_url() . '/job/' . get_the_title($post_id) . '/?lang=' . $SiteLang .                                            '&action=proposal&linguist=' . $value->by_user . '&proposalId=' . $value->id ?>">                                        <div class="fig-img slide-inn">                                            <figure>                                                <?php                                                if ($extension == 'pdf') {                                                    ?>                                                    <embed src="<?= $fileUrl ?>" width="100%" height="250"                                                           type="application/pdf">                                                    <?php                                                } elseif ($extension == 'txt') {                                                    ?>                                                    <embed src="<?= $fileUrl ?>" width="100%" height="250"                                                           type="text/plain">                                                    <?php                                                } elseif ($extension == 'php') {                                                    ?>                                                    <embed src="<?= $fileUrl ?>" width="100%" height="auto"                                                           type="text/plain">                                                    <?php                                                } elseif ($extension == 'mp3') {                                                    ?>                                                    <audio controls>                                                        <source src="<?= $fileUrl ?>" type="audio/mpeg">                                                    </audio>                                                    <?php                                                } elseif ($extension == 'doc' || $extension == 'docx') {                                                    ?>                                                    <object data="<?= $fileUrl ?>" type="application/msword"></object>                                                    <?php                                                } elseif ($extension == 'mp4' || $extension == 'mov' || $extension == '3gp' || $extension == 'wmv') {                                                    ?>                                                    <video width="400" controls>                                                        <source src="<?= $fileUrl ?>" type="video/mp4">                                                        Your browser does not support HTML5 video.                                                    </video>                                                    <?php                                                } else {                                                    ?>                                                    <img src="<?= $fileUrl ?>" alt="Cannot open <?=$extension ?>"                                                         style="width:100%;">                                                    <?php                                                }                                                ?>                                            </figure>                                            <span class="eye">                                        <img src="<?= get_template_directory_uri() . '/images/eye-see.png' ?>"                                             alt="freelinguist">                                    </span>                                        </div>                                    </a>                                    <?php                                    if (!in_array($value->by_user, get_post_meta($post_id, 'job_freeze_user')) &&                                        !empty(get_post_meta($post_id, 'job_freeze_user')))                                    {                                        echo '<div class="rating-img">                                    <div class="ratingss" id="proposal-' . $value->id . '">';                                        echo '<input type="hidden" name="rating" id="rating" value="' . $value->rating . '" />';                                        echo '<ul onMouseOut="resetRating(' . $value->id . ');" class="sliderul">';                                        for ($i = 1; $i <= 5; $i++) {                                            $selected = "";                                            if (!empty($value->rating) && $i <= $value->rating) {                                                $selected = "selected";                                            }                                            ?>                                            <li class="<?= $selected ?> large-text"                                                onmouseover="highlightStar(this,<?= $value->id?>);"                                                onmouseout="removeHighlight(<?= $value->id?>);"                                                onClick="addRating(this,<?= $value->id?>);"                                            >                                                ★                                            </li>                                            <?php                                        }                                        echo '</ul>                                            </div>';                                        if ($current_user_id == $author_id) {                                            if (!in_array($proposalId, $proposalPresent)) {                                                echo '<a href="#" class="awardProposalPrize red-text a-button regular-text" linguist="' .                                                    $value->by_user . '" proposal_id = "' . $proposalId . '"> Award This Proposal </a>';                                            } else {                                                echo '<a href="#" class="green-text  a-button regular-text"> Prize Awarded </a>';                                            }                                        }                                        echo '</div></div>';                                    }                                    echo '</li>';                                    $par++;                        } //end foreach                        ?>                    </ul>                </div>            </div>        </div> <!-- /.column-sec-->    </section>    <div class="modal" id="imagePopUpModel" role="dialog">        <div class="modal-dialog">            <!-- Modal content-->            <div class="modal-content">                <div class="modal-header">                    <button type="button" class="close huge-text" data-dismiss="modal">×</button>                    <h4 class="modal-title"></h4>                </div>                <div class="modal-body"></div>            </div>        </div>    </div>    <script type="text/javascript">        jQuery(function ($) {            jQuery('.flexslider').flexslider({                animation: "slide",                animationLoop: false,                itemWidth: 200,                controlNav: false,                itemMargin: 10,                minItems: 1,                maxItems: 4            });            $(document).on('click', '#showImageModel', function () {                var imageSrc = jQuery('#showImageModel img').attr('src');                var Image = '<img src="' + imageSrc + '">';                jQuery("#imagePopUpModel .modal-body").html(Image);                jQuery("#imagePopUpModel").modal('show');            });            jQuery('.flexslider .slides li').css('width', jQuery('body').width());            $(document).on('click', '.flexslider .slides li', function (/*e*/) {                var proposal_id = jQuery(this).data('proposal_id');                var linguid = jQuery(this).data('linguid');                var data = [];                data.push({'name': 'action', 'value': 'showproposal_slider'});                data.push({'name': 'proposal_id', 'value': proposal_id});                data.push({'name': 'linguid', 'value': linguid});                data.push({'name': 'post_id', 'value': '<?php echo $post_id;?>'});                jQuery.ajax({                    type: 'POST',                    url: adminAjax.url,                    data: data,                    global: false,                    success: function (response) {                        console.log(response);                        jQuery('#myCarousel').html(response);                    }                });            });        });    </script></div>