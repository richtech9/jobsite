<?php/* * current-php-code 2021-Feb-11 * input-sanitized : lang,linguist,proposal_id * current-wp-template:  shows proposals to PeerOK that are made by others */global $wpdb;global $post;//task-future-work arrow navigation does not work on the other proposals page (when freelancer has paid to see proposals by others)$SiteLang = FLInput::get('lang', 'en');$proposal_id = (int)FLInput::get('proposal_id');$linguist_id = (int)FLInput::get('linguist');$post_id = get_the_ID();$current_user = wp_get_current_user();$currLingu = $current_user->ID;$author_id = $post->post_author;$addParticipants = get_post_meta($post_id, 'all_contest_paricipants', true);$curParti = explode(',', $addParticipants);$uploads = wp_upload_dir();$prizesProposalAwarded = get_post_meta($post_id, 'contest_awardedProposalPrizes', true);$proposalPresent = explode(',', $prizesProposalAwarded);?><div class="customer-participants view job_dtls">    <div class="title-top">        <div class="container">            <i class="icon icon-box"></i>            <p class="large-text">                <?php echo get_post_meta($post_id, 'project_title', true); ?>            </p>        </div>    </div>    <section class="middle-content">        <div class="container participant-sec">            <div class="row submissions_btns">                <?php                $participants = $wpdb->get_results("SELECT * FROM wp_files WHERE `post_id` = $post_id AND 'user_id' = $author_id");                ?>                <a class="hirebttn2 fr"                   href="<?php echo get_site_url(); ?>/job/<?php echo get_the_title($post_id); ?>/?lang=<?php echo $SiteLang; ?>"                >                    Job Details                </a>            </div>        </div>        <div class="container upload_file_row">            <div class="content-sec">                <div class="container">                    <div class="col-md-9 slide-sec">                        <?php                        $fileUrl = array();                        $seal_exit = $wpdb->get_results("SELECT * FROM wp_fl_transaction WHERE user_id =" . $linguist_id . " AND type = 'seal_Files' AND project_id = $post_id");                        if (count($seal_exit) > 0):                            echo 'Linguist has sealed files.';                        else:                            $proposal = $wpdb->get_results("SELECT * FROM wp_proposals WHERE `post_id` = $post_id AND by_user = $linguist_id AND id=$proposal_id");                            foreach ($proposal as $pp) {                                $up_loads = $wpdb->get_results("SELECT * FROM wp_files WHERE `post_id` = $post_id AND by_user = $linguist_id AND proposal_id = $pp->id");                                foreach ($up_loads as $uploaded) {                                    $fileUrl[] = $uploads['baseurl'] . '/' . $uploaded->file_path;                                }                            }                            $countFiles = count($fileUrl);                            if (count($up_loads) > 0) {                                ?>                                <div id="myCarousel" class="carousel slide" data-ride="carousel">                                    <div class="carousel-inner">                                        <?php                                        $sl = 1;                                        foreach ($fileUrl as $key => $value) {                                            $extension = pathinfo($value, PATHINFO_EXTENSION);                                            ?>                                            <div class="item <?php echo($sl == 1 ? "active" : ""); ?>">                                                <?php                                                if ($extension == 'pdf') {                                                    echo '<embed src="' . $value . '" width="100%" height="600" type="application/pdf">';                                                } elseif ($extension == 'txt') {                                                    echo '<embed src="' . $value . '" width="100%" height="600" type="text/plain">';                                                } elseif ($extension == 'mp3') {                                                    echo '<audio controls><source src="' . $value . '" type="audio/mpeg"></audio> ';                                                } elseif ($extension == 'doc' || $extension == 'docx') {                                                    echo '<object data="' . $value . '" type="application/msword"></object>';                                                } elseif ($extension == 'mp4' || $extension == 'mov' || $extension == '3gp' || $extension == 'wmv') {                                                    echo '<video width="400" controls>									  <source src="' . $value . '" type="video/mp4">									  Your browser does not support HTML5 video.									</video>';                                                } else {                                                    echo '<img src="' . $value . '" alt="Cannot open ' . $extension . '" style="width:100%;">';                                                }                                                ?>                                            </div>                                            <?php                                            $sl++;                                        }                                        ?>                                    </div>                                    <!-- Left and right controls -->                                    <a class="left carousel-control" href="#myCarousel" data-slide="prev">                                        <span class="flex-nav-prev"></span>                                    </a>                                    <a class="right carousel-control" href="#myCarousel" data-slide="next">                                        <span class="flex-nav-next"></span>                                    </a>                                </div>                            <?php } else {                                echo '<span>Linguist have not uploaded any files.</span>';                            }                        endif;                        ?>                    </div>                    <div class="col-md-3 right-notify">                        <div class="hz_discussion_row prize-lists">                            <?php                            echo hz_fl_discussion_list_both($post_id, $currLingu, $author_id); ?>                        </div>                        <div class="message-sec text-box">                            <form id="contest_discussion">                                <textarea required name="comment" title="comment" autocomplete="off" ></textarea>                                <input type="hidden" name="post_id" value="<?php echo $post_id; ?>">                                <input type="hidden" name="comment_to" value="<?php echo $author_id; ?>">                                <input type="submit" class="red-btn large-text" value="Contact Customer">                            </form>                        </div>                    </div>                </div>            </div>            <div class="column-sec slide-content">                <div class="container--">                    <div class="flexslider carousel">                        <ul class="slides">                            <?php                            $par = 1;                            $all_proposals = $wpdb->get_results("SELECT * FROM wp_proposals WHERE `post_id` = $post_id AND by_user!=$currLingu AND by_user IS NOT NULL  order by id desc");                            foreach ($all_proposals as $key => $value) {                                //foreach ($getParts as $key => $value) {                                $sealExistsForParticipant = $wpdb->get_results("SELECT * FROM wp_fl_transaction WHERE user_id =" . $value->by_user . " AND type = 'seal_Files' AND project_id=$post_id");                                if (count($sealExistsForParticipant) >= 1) {                                } else {                                    $LingUser = get_user_by('id', $value->by_user);                                    $mySubmissions = $wpdb->get_results("SELECT * FROM wp_files WHERE `post_id` = $post_id AND by_user = $value->by_user AND proposal_id=$value->id");                                    foreach ($mySubmissions as $uploaded) {                                        $fileUrl = $uploads['baseurl'] . '/' . $uploaded->file_path;                                        break;                                    }                                    $extension = pathinfo($fileUrl, PATHINFO_EXTENSION);                                    $class = '';                                    if (in_array($value->id, $proposalPresent) && $value->id != '') {                                        $class = 'highlight';                                    }                                    $next_link = get_site_url() . '/job/' . get_the_title($post_id) . '/?lang=' . $SiteLang . '&action=other-translator-proposal&linguist=' . $value->by_user . '&proposal_id=' . $value->id;                                    echo '<li class="columns ' . $class . '">										<div class="box">										<div class="num-row large-text">											' . $par . ' by <a href="' . $next_link . '">' . $LingUser->display_name . '</a>										</div>										<div class="fig-img">											<figure>';                                    if ($extension == 'pdf') {                                        echo '<embed src="' . $fileUrl . '" width="100%" height="auto" type="application/pdf">';                                    } elseif ($extension == 'txt') {                                        echo '<embed src="' . $fileUrl . '" width="100%" height="auto" type="text/plain">';                                    } elseif ($extension == 'mp3') {                                        echo '<audio controls><source src="' . $fileUrl . '" type="audio/mpeg"></audio> ';                                    } elseif ($extension == 'doc' || $extension == 'docx') {                                        echo '<object data="' . $fileUrl . '" type="application/msword"></object>';                                    } elseif ($extension == 'mp4' || $extension == 'mov' || $extension == '3gp' || $extension == 'wmv') {                                        echo '<video width="400" controls>													<source src="' . $fileUrl . '" type="video/mp4">													Your browser does not support HTML5 video.													</video>';                                    } else {                                        echo '<img src="' . $fileUrl . '" alt="Cannot open ' . $extension . '" style="width:100%;">';                                    }                                    echo '</figure>															</div>										<div class="rating-img">											<div class="ratingss inline-here" id="proposal-' . $value->id . '">';                                    echo '<input type="hidden" name="rating" id="rating" value="' . $value->rating . '" />';                                    echo '<ul class="sliderul">';                                    for ($i = 1; $i <= 5; $i++) {                                        $selected = "";                                        if (!empty($value->rating) && $i <= $value->rating) {                                            $selected = "selected";                                        }                                        echo '<li class="' . $selected . ' large-text">★</li>';                                    }                                    echo '</ul>														</div>';                                    echo '</div></div>									</li>';                                    $par++;                                }                            }                            ?>                        </ul>                    </div>                </div>            </div>        </div>    </section></div><script type="text/javascript">    jQuery(function () {        jQuery('.flexslider').flexslider({            animation: "slide",            animationLoop: false,            itemWidth: 200,            controlNav: false,            itemMargin: 10,            minItems: 1,            maxItems: 4        });    });    jQuery('.flexslider .slides li').css('width', jQuery('body').width());</script>