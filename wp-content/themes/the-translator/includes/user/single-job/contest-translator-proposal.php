<?php/** current-php-code 2020-Oct-10* input-sanitized : lang,proposal_id* current-wp-template:  freelancer contest, viewing existing proposal*/global $wpdb;global $post;$proposal_id = FLInput::get('proposal_id');$lang = FLInput::get('lang', 'en');$post_id 			= get_the_ID();$current_user 		= wp_get_current_user();$SiteLang = $lang;$currLingu = $current_user->ID;$job_freeze = false;if(in_array($currLingu,get_post_meta($post_id,'job_freeze_user')) && !empty(get_post_meta($post_id,'job_freeze_user'))){    $job_freeze = true;}$author_id=$post->post_author;$addParticipants = get_post_meta($post_id,'all_contest_paricipants',true);$curParti = explode(',', $addParticipants);$uploads = wp_upload_dir();$getBalance = (float)get_user_meta($currLingu, 'total_user_balance', true);if (!(empty($_POST)) && ($getBalance < 0)) {    //redirect to the same page again to show wallet    $my_url_here = get_site_url() . '/job/' . get_the_title($post_id) . '/?lang=' . $SiteLang .        '&action=proposal&proposal_id='.$proposal_id.'&linguist='.$currLingu;    wp_redirect($my_url_here);    exit;}?><style>    .slide-inn figure{        height:auto !important;    }    .slider .eye img, .eye img {        display: inline-block !important;        height: auto !important;        width: auto !important;        vertical-align: middle;        background: transparent !important;        margin: 0 auto;    }    .slide-inn .eye {        left: 0;        position: absolute;        text-align: center;        top: 40%;        width: 100%;        z-index: 10;        display: none;    }</style><div class="customer-participants view job_dtls">    <div class="title-top">        <div class="container">            <i class="icon icon-box"></i>            <p  class="large-text">                <?php echo get_post_meta($post_id, 'project_title', true); ?>            </p>        </div>    </div>    <section class="middle-content">        <div class="container participant-sec">            <div class="row submissions_btns fl-align-right">                <?php                $participants = $wpdb->get_results( "SELECT * FROM wp_files WHERE `post_id` = $post_id AND 'user_id' = $author_id" );                ?>                <?php                $sealExists = $wpdb->get_results(                        "SELECT * FROM wp_fl_transaction WHERE user_id =".$currLingu." AND type = 'seal_Files'  AND project_id = $post_id");                $b_seal_exists = false;                if( (count($sealExists) >= 1)) {                    $b_seal_exists = true;                }                if(!$job_freeze){                    $seal_fee = (float)get_option('seal_fee') ? get_option('seal_fee') : 10;                    ?>                    <div class="fl-seal-content">                        <?php if( $b_seal_exists ){?>                            <span class="fl-outer-dets">                                <span class="fl-inner-dets">All your uploads are sealed. </span>                                <small>( only the customer can see it. )</small>                            </span>                        <?php } else if ($b_seal_exists) { ?>                            <span class="fl-outer-dets" ></span>                        <?php } else { ?>                        <button class="fl-proposals-seal" data-jobid="<?= $post_id?>">                            Seal Submissions                        </button>                        <br>                        <span class="fl-outer-dets">                            <span class="fl-inner-dets">Seal all my submissions: $<?= $seal_fee ?> </span>                            <small>( only the customer can see it. )</small>                            <span class="fl-error" style="display: none"></span>                        </span>                        <?php } //end if else seal not purchased  ?>                    </div>                    <?php                }//end if not job freeze                ?>                <a class="hirebttn2 fl-trans-proposals-button-nudge "                   href="<?php echo get_site_url(); ?>/job/<?php echo get_the_title($post_id); ?>/?lang=<?php echo $SiteLang; ?>&action=proposals"                >                    Proposals                </a>            </div>        </div>        <div class="container upload_file_row">        </div> <!-- /.container.upload_file_row -->        <div class="content-sec">            <div class="container">                <div class="col-md-9 slide-sec">                    <?php                    $fileUrl = array();                    $proposal = $wpdb->get_results( "SELECT * FROM wp_proposals WHERE `post_id` = $post_id AND by_user = $currLingu AND id=$proposal_id"  );                    foreach ($proposal as $pp) {                        $up_loads = $wpdb->get_results( "SELECT * FROM wp_files WHERE `post_id` = $post_id AND by_user = $currLingu AND proposal_id = $pp->id" );                        foreach ($up_loads as $uploaded) {                            $fileUrl[] = $uploads['baseurl'].'/'.$uploaded->file_path;                        }                    }                    $countFiles = count($fileUrl);                    if(count($up_loads) > 0){                        ?>                        <div id="myCarousel" class="carousel slide" data-ride="carousel">                            <div class="carousel-inner">                                <?php                                $sl = 1;                                foreach ($fileUrl as $key => $value) {                                    $extension = pathinfo($value, PATHINFO_EXTENSION);                                    ?>                                    <div class="item <?php echo ($sl == 1 ? "active": ""); ?>">                                        <?php                                        if ($extension == 'pdf') { ?>                                            <embed src="<?= $value ?>" width="100%" height="600" type="application/pdf"><?php                                        } elseif ($extension == 'txt') { ?>                                            <embed src="<?= $value ?>" width="100%" height="600" type="text/plain"><?php                                        } elseif ($extension == 'php') { ?>                                            <embed src="<?= $value ?>" width="100%" height="600" type="text/plain"><?php                                        } elseif ($extension == 'mp3') { ?>                                            <audio controls>                                                <source src="<?= $value ?>" type="audio/mpeg">                                            </audio> <?php                                        } elseif ($extension == 'doc' || $extension == 'docx') { ?>                                            <object data="<?= $value ?>" type="application/msword"></object><?php                                        } elseif ($extension == 'mp4' || $extension == 'mov' || $extension == '3gp' || $extension == 'wmv') {                                            ?>                                            <video width="400" controls>                                                <source src="<?= $value ?>" type="video/mp4">                                                Your browser does not support HTML5 video.                                            </video>                                            <?php                                        } else { ?><img src="<?= $value ?>" alt="Cannot open <?= $extension ?>"                                                        style="width:100%;"><?php                                        }                                        ?>                                    </div>                                    <?php                                    $sl++;                                }                                ?>                                <div class="freelinguist-id-display" style="">                                    <span class="small-text">                                        <?= $proposal_id ?>                                    </span>                                </div>                            </div>                            <!-- Left and right controls -->                            <a class="left carousel-control" href="#myCarousel" data-slide="prev">                                <span class="flex-nav-prev"></span>                            </a>                            <a class="right carousel-control" href="#myCarousel" data-slide="next">                                <span class="flex-nav-next"></span>                            </a>                        </div>                    <?php } else{                        echo '<span>You have not uploaded any files.</span>';                    } ?>                </div>                <div class="col-md-3 right-notify">                    <div class="hz_discussion_row prize-lists">                        <?php                        echo hz_fl_discussion_list_both( $post_id,$currLingu,$author_id ); ?>                    </div>                    <div class="message-sec text-box">                        <form id="contest_discussion">                            <textarea title ="comment" required name="comment" autocomplete="off" ></textarea>                            <input type="hidden" name="post_id" value="<?php echo $post_id; ?>">                            <input type="hidden" name="comment_to" value="<?php echo $author_id; ?>">                            <input type="submit" class="red-btn enhanced-text" value="Contact Customer">                        </form>                    </div>                </div>            </div>        </div>        <div class="column-sec slide-content">            <div class="container">                <div class="flexslider carousel">                    <ul class="slides">                        <?php                        $par = 1;                        $all_proposals = $wpdb->get_results(                            "SELECT * FROM wp_proposals WHERE `post_id` = $post_id AND by_user!=$currLingu order by id desc" );                        $viewSealExists = $wpdb->get_results(                            "SELECT * FROM wp_fl_transaction WHERE user_id =".$currLingu." AND type = 'view_Sealed'  AND  project_id = $post_id" );                        if(count($viewSealExists)>1) {                            foreach ($all_proposals as $key => $value) {                                if (empty(intval($value->by_user))) { continue;}                                //foreach ($getParts as $key => $value) {                                $sealExistsForParticipant = $wpdb->get_results(                                    "SELECT * FROM wp_fl_transaction WHERE user_id =" . $value->by_user . " AND type = 'seal_Files'  AND project_id = $post_id");                                if (count($sealExistsForParticipant) >= 1) {                                } else {                                    $LingUser = get_user_by('id', $value->by_user);                                    $mySubmissions = $wpdb->get_results(                                        "SELECT * FROM wp_files WHERE `post_id` = $post_id AND by_user = $value->by_user AND proposal_id=$value->id");                                    foreach ($mySubmissions as $uploaded) {                                        $fileUrl = $uploads['baseurl'] . '/' . $uploaded->file_path;                                        break;                                    }                                    $extension = pathinfo($fileUrl, PATHINFO_EXTENSION);                                    ?>                                    <li class="columns">                                        <div class="box">                                            <div class="num-row">                                                <?= $par ?> by <a href="<?=                                                get_site_url() . '/job/' . get_the_title($post_id) . '/?lang=' .                                                $SiteLang . '&action=other-translator-proposal&linguist=' . $value->by_user .                                                '&proposal_id=' . $value->id ?>"                                                >                                                    <?= $LingUser->display_name ?>                                                </a>                                            </div> <!-- /.num-row -->                                            <div class="fig-img slide-inn">                                                <figure>                                                    <?php                                                    if ($extension == 'pdf') { ?>                                                        <embed src="<?= $fileUrl ?>" width="100%" height="auto"                                                               type="application/pdf"><?php                                                        ;                                                    } elseif ($extension == 'txt') { ?>                                                        <embed src="<?= $fileUrl ?>" width="100%" height="auto"                                                               type="text/plain"><?php                                                        ;                                                    } elseif ($extension == 'php') { ?>                                                        <embed src="<?= $fileUrl ?>" width="100%" height="auto"                                                               type="text/plain"><?php                                                        ;                                                    } elseif ($extension == 'mp3') { ?>                                                        <audio controls>                                                            <source src="<?= $fileUrl ?>'" type="audio/mpeg"></audio> <?php                                                        ;                                                    } elseif ($extension == 'doc' || $extension == 'docx') {                                                        ?>                                                    <object data="<?= $fileUrl ?>"                                                            type="application/msword"></object><?php                                                        ;                                                    } elseif ($extension == 'mp4' || $extension == 'mov' || $extension == '3gp' || $extension == 'wmv') {                                                        ?>                                                        <video width="400" controls>                                                            <source src="<?= $fileUrl ?>" type="video/mp4">                                                            Your browser does not support HTML5 video.                                                        </video>                                                        <?php                                                    } else { ?><img src="<?= $fileUrl ?>"                                                                    alt="Cannot open <?= $extension ?>"                                                                    style="width:100%;"><?php                                                        ;                                                    }//end if extension block                                                    ?>                                                </figure>                                                <span class="eye">                                                        <img src="<?= get_template_directory_uri() . '/images/eye-see.png' ?>"                                                             alt="freelinguist"/>                                                    </span>                                            </div> <!-- /.fig-img-->                                            <div class="rating-img inline-here">                                                <div class="ratingss" id="proposal-<?=$value->id?>">                                                    <input type="hidden" name="rating" id="rating"                                                           value="<?=$value->rating?>"/>                                                    <ul class="sliderul">                                                        <?php                                                        for ($i = 1; $i <= 5; $i++) {                                                            $selected = "";                                                            if (!empty($value->rating) && $i <= $value->rating) {                                                                $selected = "selected";                                                            }                                                            ?>                                                            <li class=" large-text'.$selected.'">★</li><?php                                                        }                                                        ?>                                                    </ul> <!--- /.sliderul -->                                                </div> <!-- /.ratingss -->                                            </div> <!-- /.rating-img -->                                        </div>  <!-- /.box -->                                    </li> <!-- /.columns-->                                    <?php                                    $par++;                                }                            }                        } //end if count $viewSealExists >=1                        ?>                    </ul> <!-- /.slides --->                </div>	<!-- /.flexslider -->                <?php                if(count($viewSealExists)>=1) {                } else {                    if (!$job_freeze) {                        $fee = floatval(get_option('view_other_proposals_fee',10));                        ?>                        <div class="col-md-3 col-sm-6 view_other_list fl-proposals-view-buy" style="border:1px solid #ccc">                            <div class="list_content">                                <div >                                    <label class="search_icon larger-text">                                        <span class="glyphicon glyphicon-search"></span>                                    </label>                                    <label class="rate larger-text">Pay <?= $fee ?>$</label>                                    <button class="btn brn_view_o enhanced-text fl-proposals-view"                                             type="button"                                             data-jobid="<?= $post_id?>"                                    >                                        View other proposals                                    </button>                                </div>                                <p class="large-text">                                    View the Submissions of all the other Competitor that are not sealed                                </p>                                <span class="fl-error" style="display: none"></span>                            </div> <!-- /.list_content -->                        </div> <!-- /.view_other_list -->                        <?php                    } //end if !$job_freeze                } //end if else count of $viewSealExists >=1                ?>            </div> <!-- /.container -->        </div>	<!-- /.section.middle-content -->    </section> <!-- /.middle-content--></div> <!-- /.customer-participants view job_dtls --><script type="text/javascript">    jQuery(function() {        jQuery('.flexslider').flexslider({            animation: "slide",            animationLoop: false,            itemWidth: 200,            controlNav:false,            itemMargin: 10,            minItems: 1,            maxItems: 4        });    });    jQuery('.flexslider .slides li').css('width', jQuery('body').width());</script>